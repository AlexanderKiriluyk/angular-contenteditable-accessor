{"version":3,"file":"tinkoff-angular-contenteditable-accessor.umd.js.map","sources":["ng://@tinkoff/angular-contenteditable-accessor/lib/contenteditable-value-accessor.ts","ng://@tinkoff/angular-contenteditable-accessor/lib/module.ts"],"sourcesContent":["import {\r\n    AfterViewInit,\r\n    Directive,\r\n    ElementRef,\r\n    forwardRef,\r\n    HostListener,\r\n    Inject,\r\n    OnDestroy,\r\n    Renderer2,\r\n} from '@angular/core';\r\nimport {ControlValueAccessor, NG_VALUE_ACCESSOR} from '@angular/forms';\r\n\r\n/*\r\n * This is a barebones contenteditable {@link ControlValueAccessor} allowing you to use\r\n * Angular forms with native contenteditable HTML. For security reasons you might want\r\n * to consider sanitizing pasted/dropped content before using it. Also make sure that\r\n * you do not set any dangerous content as control value yourself, because directive\r\n * just outputs control value as-is.\r\n */\r\n@Directive({\r\n    selector:\r\n        '[contenteditable][formControlName], [contenteditable][formControl], [contenteditable][ngModel]',\r\n    providers: [\r\n        {\r\n            provide: NG_VALUE_ACCESSOR,\r\n            useExisting: forwardRef(() => ContenteditableValueAccessor),\r\n            multi: true,\r\n        },\r\n    ],\r\n})\r\nexport class ContenteditableValueAccessor\r\n    implements ControlValueAccessor, AfterViewInit, OnDestroy {\r\n    /*\r\n     * MutationObserver IE11 fallback (as opposed to input event for modern browsers).\r\n     * When mutation removes a tag, i.e. delete is pressed on the last remaining character\r\n     * inside a tag â callback is triggered before the DOM is actually changed, therefore\r\n     * setTimeout is used\r\n     */\r\n    private observer = new MutationObserver(() => {\r\n        setTimeout(() => {\r\n            this.onChange(\r\n                ContenteditableValueAccessor.processValue(\r\n                    this.elementRef.nativeElement.innerHTML,\r\n                ),\r\n            );\r\n        });\r\n    });\r\n\r\n    /*\r\n     * onTouch callback that marks control as touched and allows FormHooks use\r\n     */\r\n    private onTouched = () => {};\r\n\r\n    /*\r\n     * onChange callback that writes value to control and allows FormHooks use\r\n     */\r\n    private onChange: (value: string) => void = () => {};\r\n\r\n    constructor(\r\n        @Inject(ElementRef) private readonly elementRef: ElementRef,\r\n        @Inject(Renderer2) private readonly renderer: Renderer2,\r\n    ) {}\r\n\r\n    /*\r\n     * To support IE11 MutationObserver is used to monitor changes to the content\r\n     */\r\n    ngAfterViewInit() {\r\n        this.observer.observe(this.elementRef.nativeElement, {\r\n            characterData: true,\r\n            childList: true,\r\n            subtree: true,\r\n        });\r\n    }\r\n\r\n    /*\r\n     * Disconnect MutationObserver IE11 fallback on destroy\r\n     */\r\n    ngOnDestroy() {\r\n        this.observer.disconnect();\r\n    }\r\n\r\n    /*\r\n     * Listen to input events to write innerHTML value into control,\r\n     * also disconnect MutationObserver as it is not needed if this\r\n     * event works in current browser\r\n     */\r\n    @HostListener('input')\r\n    onInput() {\r\n        this.observer.disconnect();\r\n        this.onChange(\r\n            ContenteditableValueAccessor.processValue(\r\n                this.elementRef.nativeElement.innerHTML,\r\n            ),\r\n        );\r\n    }\r\n\r\n    /*\r\n     * Listen to blur event to mark control as touched\r\n     */\r\n    @HostListener('blur')\r\n    onBlur() {\r\n        this.onTouched();\r\n    }\r\n\r\n    /*\r\n     * Reacts to external change\r\n     *\r\n     * @see {@link ControlValueAccessor#writeValue}\r\n     */\r\n    writeValue(value: string | null) {\r\n        this.renderer.setProperty(\r\n            this.elementRef.nativeElement,\r\n            'innerHTML',\r\n            ContenteditableValueAccessor.processValue(value),\r\n        );\r\n    }\r\n\r\n    /*\r\n     * Registers onChange callback\r\n     *\r\n     * @see {@link ControlValueAccessor#registerOnChange}\r\n     */\r\n    registerOnChange(onChange: (value: string) => void) {\r\n        this.onChange = onChange;\r\n    }\r\n\r\n    /*\r\n     * Registers onTouch callback\r\n     *\r\n     * @see {@link ControlValueAccessor#registerOnTouched}\r\n     */\r\n    registerOnTouched(onTouched: () => void) {\r\n        this.onTouched = onTouched;\r\n    }\r\n\r\n    /*\r\n     * Sets disabled state by setting contenteditable attribute to true/false\r\n     *\r\n     * @see {@link ControlValueAccessor#setDisabledState}\r\n     */\r\n    setDisabledState(disabled: boolean) {\r\n        this.renderer.setAttribute(\r\n            this.elementRef.nativeElement,\r\n            'contenteditable',\r\n            String(!disabled),\r\n        );\r\n    }\r\n\r\n    /*\r\n     * null and other falsy control values are treated as empty string to\r\n     * prevent IE11 outputting 'null', also single <br> is replaced with empty\r\n     * string when passed to the control\r\n     */\r\n    private static processValue(value: string | null): string {\r\n        const processed = value || '';\r\n\r\n        return processed.trim() === '<br>' ? '' : processed;\r\n    }\r\n}\r\n","import {NgModule} from '@angular/core';\r\nimport {ContenteditableValueAccessor} from './contenteditable-value-accessor';\r\n\r\n@NgModule({\r\n    declarations: [ContenteditableValueAccessor],\r\n    exports: [ContenteditableValueAccessor],\r\n})\r\nexport class ContenteditableValueAccessorModule {}\r\n"],"names":["Directive","NG_VALUE_ACCESSOR","forwardRef","ElementRef","Inject","Renderer2","HostListener","NgModule"],"mappings":"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"}
